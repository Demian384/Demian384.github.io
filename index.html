<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cat√°logo de Productos</title>
  <link rel="stylesheet" href="style1.css"/>
</head>

<body>
   <!-- HEADER -->
    
  <header>
    <div class="logo">
      <img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fi.pinimg.com%2F736x%2F3b%2Fa4%2Fe3%2F3ba4e34f4cd985b7fdf0baa0c1056864.jpg&f=1&nofb=1&ipt=e75d007972b7909d0f7d289a901ec6eb7f15b6d440c26a11d51668f215bfabb7" alt="Logo">
      <span>Basar "Zar"</span>
    </div>

    <div class="search-bar">
      <input type="text" id="buscador" placeholder="Buscar productos...">
    </div>

    <div class="contact-info">
      <div>üìç Esteban de luca 1647</div>
      <div>üìû (011) 1234-5678</div>
    </div>
    <button id="menu-toggle" class="menu-btn">‚ò∞ Categor√≠as</button>
  </header>


   <!-- CONTENIDO PRINCIPAL -->

  <div class="main-container">

    <!-- BARRA LATERAL -->

  <aside>
      <h3>Categor√≠as</h3>
      <div id="lista-categorias"></div>
  </aside>

    <!-- CAT√ÅLOGO -->
    <main style="flex: 1;">
      <h1 style="text-align:center;">üõçÔ∏è Cat√°logo de Productos</h1>
      <div id="productos" class="catalogo"></div>
      <div id="loading" class="loading">Cargando productos...</div>
    </main>
  </div>
  
  <script>
    const SHEET_ID = "1obKolP4ymvk-uzkFbB5eDrrh5e8o9SVskaBLUEAe3ZY"; // <-- Tu ID
    const API_KEY = "AIzaSyAtxY5t7fOIcOwAdff4OSAyV6gtfY8H9E4";       // <-- Tu clave
    const RANGE = "Hoja1!A2:E"; // A=Nombre, B=Descripci√≥n, C=Precio, D=Imagen_URL, E=Categor√≠a
    const NUMERO_WHATSAPP = "5492944165050"
    let categoriasSet = new Set();
    let paginaActual = 1;
    const productosPorPagina = 8;
    let productosFiltrados = [];
    let productosData = [];


    async function cargarProductos() {
      try {
        const respuesta = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`);
        const data = await respuesta.json();
        const contenedor = document.getElementById("productos");
        const loader = document.getElementById("loading");
        loader.style.display = "none";

        productosData = data.values || [];
        
        // üîπ Capturamos las categor√≠as √∫nicas de la hoja (columna E)
          categoriasSet.clear();
          productosData.forEach(fila => {
          const categoria = fila[4] || "Sin categor√≠a";
          categoriasSet.add(categoria);
        }
      );

         // üîπ Generamos la barra lateral de forma autom√°tica
          renderizarCategorias();

        if (!data.values || data.values.length === 0) {
          contenedor.innerHTML = "<p>No hay productos disponibles.</p>";
          return;
        }

        let html = "";
        data.values.forEach(fila => {
          const [nombre, descripcion, precio, imagen, categoria] = fila;

          const mensaje = encodeURIComponent(`Hola, estoy interesado en el producto "${nombre}"`);
          const linkWhatsApp = `https://wa.me/${NUMERO_WHATSAPP}?text=${mensaje}`;
          html += `
            <div class="producto" data-cat="${categoria || 'Sin categor√≠a'}">
              <img src="${imagen || 'sin-imagen.jpg'}" alt="${nombre}" onerror="this.src='sin-imagen.jpg';">
              <div class="info">
                <h3>${nombre || 'Sin nombre'}</h3>
                <p>${descripcion || 'Sin descripci√≥n'}</p>
                <span class="precio">${precio ? precio : ''}</span>
                <a class="whatsapp-btn" href="${linkWhatsApp}" target="_blank" title="Consultar por WhatsApp">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/WhatsApp_icon.png" alt="WhatsApp" />
                </a>
              </div>
            </div>
          `;
        });

        /* contenedor.innerHTML = html; */
        renderizarPagina(1);
        crearControlesPaginacion();

      } catch (error) {
        console.error("Error al cargar datos:", error);
        document.getElementById("loading").innerText = "‚ùå Error al cargar los productos.";
      }
    }

    // üîç Filtro del buscador
    document.getElementById("buscador").addEventListener("input", e => {
      const filtro = e.target.value.toLowerCase();
      
  // üîπ Filtrar productos por nombre o descripci√≥n
  productosFiltrados = productosData.filter(fila => {
    const nombre = fila[0]?.toLowerCase() || "";
    const descripcion = fila[1]?.toLowerCase() || "";
    return nombre.includes(filtro) || descripcion.includes(filtro);
  });

  // üîπ Reiniciar a la primera p√°gina
  paginaActual = 1;
  renderizarPagina(paginaActual);
  crearControlesPaginacion();
});
/*       const productos = document.querySelectorAll(".producto");
      productos.forEach(p => {
        const nombre = p.querySelector("h3").textContent.toLowerCase();
        const descripcion = p.querySelector("p").textContent.toLowerCase();
        p.style.display = (nombre.includes(filtro) || descripcion.includes(filtro)) ? "block" : "none"; */

       

/*       function renderizarCategorias() {
        const contenedor = document.getElementById("lista-categorias");
        contenedor.innerHTML = ""; // Limpiar categor√≠as previas

  // üîπ Opci√≥n "Todas"
        const todas = document.createElement("div");
        todas.className = "categoria activa";
        todas.dataset.cat = "todas";
        todas.textContent = "Todas";
        contenedor.appendChild(todas);

  // üîπ Crear categor√≠a por cada valor √∫nico
      [...categoriasSet].sort().forEach(cat => {
        const item = document.createElement("div");
        item.className = "categoria";
        item.dataset.cat = cat;
        item.textContent = cat;
        contenedor.appendChild(item);
  });

  // üîπ Activar filtro
  document.querySelectorAll(".categoria").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".categoria").forEach(c => c.classList.remove("activa"));
      btn.classList.add("activa");

      const cat = btn.dataset.cat;
      const productos = document.querySelectorAll(".producto");
      productos.forEach(p => {
        const productoCat = p.dataset.cat || "Sin categor√≠a";
        p.style.display = (cat === "todas" || productoCat === cat) ? "block" : "none";
      });
    });
  });
} */

function renderizarCategorias() {
  const contenedor = document.getElementById("lista-categorias");
  contenedor.innerHTML = ""; // Limpiar categor√≠as previas

  // üîπ Crear la opci√≥n "Todas"
  const todas = document.createElement("div");
  todas.className = "categoria activa";
  todas.dataset.cat = "todas";
  todas.textContent = "Todas";
  contenedor.appendChild(todas);

  // üîπ Crear categor√≠a por cada valor √∫nico y contar cu√°ntos productos tiene
  const conteoCategorias = {};
  productosData.forEach(fila => {
    const categoria = fila[4] || "Sin categor√≠a";
    conteoCategorias[categoria] = (conteoCategorias[categoria] || 0) + 1;
  });

  // üîπ Reseteo autom√°tico de p√°gina al cambiar de categor√≠a
paginaActual = 1;
renderizarPagina(paginaActual);
crearControlesPaginacion();

  [...categoriasSet].sort().forEach(cat => {
    const item = document.createElement("div");
    item.className = "categoria";
    item.dataset.cat = cat;
    item.textContent = `${cat} (${conteoCategorias[cat] || 0})`;

    // üîπ Si no hay productos, marcar como desactivado
    if (!conteoCategorias[cat]) {
      item.classList.add("inactiva");
      item.style.pointerEvents = "none";
      item.style.opacity = "0.5";
    }

    contenedor.appendChild(item);
  });

  // üîπ Asignar eventos de clic a las categor√≠as activas
  document.querySelectorAll(".categoria:not(.inactiva)").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".categoria").forEach(c => c.classList.remove("activa"));
      btn.classList.add("activa");

      const cat = btn.dataset.cat;
      // üîπ Filtrar productos por categor√≠a
productosFiltrados = productosData.filter(fila => {
  const categoriaFila = fila[4] || "Sin categor√≠a";
  return cat === "todas" || categoriaFila === cat;
});

// üîπ Reiniciar paginaci√≥n
paginaActual = 1;
renderizarPagina(paginaActual);
crearControlesPaginacion();
    });
  });
}
function renderizarPagina(pagina) {
  const contenedor = document.getElementById("productos");
  const inicio = (pagina - 1) * productosPorPagina;
  const fin = inicio + productosPorPagina;

  const productosPagina = (productosFiltrados.length > 0 ? productosFiltrados : productosData).slice(inicio, fin);
  let html = "";

  productosPagina.forEach(fila => {
    const [nombre, descripcion, precio, imagen, categoria] = fila;
    const mensaje = encodeURIComponent(`Hola, estoy interesado en el producto "${nombre}"`);
    const linkWhatsApp = `https://wa.me/${NUMERO_WHATSAPP}?text=${mensaje}`;

    html += `
      <div class="producto" data-cat="${categoria || 'Sin categor√≠a'}">
        <img src="${imagen || 'sin-imagen.jpg'}" alt="${nombre}" onerror="this.src='sin-imagen.jpg';">
        <div class="info">
          <h3>${nombre || 'Sin nombre'}</h3>
          <p>${descripcion || 'Sin descripci√≥n'}</p>
          <span class="precio">${precio || ''}</span>
          <a class="whatsapp-btn" href="${linkWhatsApp}" target="_blank" title="Consultar por WhatsApp">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/WhatsApp_icon.png" alt="WhatsApp" />
          </a>
        </div>
      </div>
    `;
  });

  contenedor.innerHTML = html;
}

function crearControlesPaginacion() {
  const totalProductos = productosFiltrados.length > 0 ? productosFiltrados.length : productosData.length;
  const totalPaginas = Math.ceil(totalProductos / productosPorPagina);
  
  const main = document.querySelector("main");
  let paginacion = document.getElementById("paginacion");

  // Si existe el div de paginaci√≥n pero no hay suficientes productos, lo eliminamos
  if (paginacion && totalPaginas <= 1) {
    paginacion.remove();
    return;
  }

  // Si no hay suficientes productos para paginar, no creamos el control
  if (totalPaginas <= 1) {
    return;
  }

  if (!paginacion) {
    paginacion = document.createElement("div");
    paginacion.id = "paginacion";
    paginacion.style.textAlign = "center";
    paginacion.style.margin = "20px";
    main.appendChild(paginacion);
  }

paginacion.innerHTML = `
  <button id="primera" ${paginaActual === 1 ? "disabled" : ""}>‚èÆÔ∏è</button>
  <button id="anterior" ${paginaActual === 1 ? "disabled" : ""}>‚¨ÖÔ∏è</button>
  <span style="margin: 0 10px;">P√°gina ${paginaActual} de ${totalPaginas}</span>
  <button id="siguiente" ${paginaActual === totalPaginas ? "disabled" : ""}>‚û°Ô∏è</button>
  <button id="ultima" ${paginaActual === totalPaginas ? "disabled" : ""}>‚è≠Ô∏è</button>
`;

document.getElementById("primera").addEventListener("click", () => {
  paginaActual = 1;
  renderizarPagina(paginaActual);
  crearControlesPaginacion();
});
document.getElementById("ultima").addEventListener("click", () => {
  paginaActual = totalPaginas;
  renderizarPagina(paginaActual);
  crearControlesPaginacion();
});

  document.getElementById("anterior").addEventListener("click", () => {
    if (paginaActual > 1) {
      paginaActual--;
      renderizarPagina(paginaActual);
      crearControlesPaginacion();
    }
  });

  document.getElementById("siguiente").addEventListener("click", () => {
    if (paginaActual < totalPaginas) {
      paginaActual++;
      renderizarPagina(paginaActual);
      crearControlesPaginacion();
      
    }
  });
}
    cargarProductos();

// üîπ Men√∫ desplegable (m√≥vil) con backdrop
const menuBtn = document.getElementById("menu-toggle");
const aside = document.querySelector("aside");

function closeAsideMobile() {
  if (!aside) return;
  aside.classList.remove('activo');
  const backdrop = document.getElementById('aside-backdrop');
  if (backdrop) backdrop.classList.remove('visible');
  // small delay to allow transition
  setTimeout(() => {
    if (backdrop && backdrop.parentNode) backdrop.parentNode.removeChild(backdrop);
  }, 220);
  document.body.style.overflow = '';
}

function openAsideMobile() {
  if (!aside) return;
  // create backdrop if not present
  let backdrop = document.getElementById('aside-backdrop');
  if (!backdrop) {
    backdrop = document.createElement('div');
    backdrop.id = 'aside-backdrop';
    backdrop.className = 'aside-backdrop';
    document.body.appendChild(backdrop);
    backdrop.addEventListener('click', closeAsideMobile);
  }
  // show
  setTimeout(() => backdrop.classList.add('visible'), 10);
  aside.classList.add('activo');
  document.body.style.overflow = 'hidden'; // prevent background scroll
}

menuBtn.addEventListener('click', () => {
  if (aside.classList.contains('activo')) closeAsideMobile();
  else openAsideMobile();
});

// Ajuste din√°mico del offset del aside para quedar justo debajo del header
// Ajuste din√°mico del offset del aside para quedar justo debajo del header
function actualizarOffsetAside() {
  const header = document.querySelector('header');
  const asideEl = document.querySelector('aside');
  if (!header || !asideEl) return;

  // calcular altura real del header (incluye padding y bordes)
  const alturaHeader = Math.ceil(header.getBoundingClientRect().height);

  // aplicar como top al aside (sticky) para que no se superponga
  /* asideEl.style.top = alturaHeader + 'px'; */
}

// Debounced scheduler usando requestAnimationFrame para evitar recalculos excesivos
let rafId = null;
function scheduleActualizarAside() {
  if (rafId) cancelAnimationFrame(rafId);
  rafId = requestAnimationFrame(() => {
    actualizarOffsetAside();
    rafId = null;
  });
}

// Observadores y listeners para cambios en el header
window.addEventListener('load', scheduleActualizarAside);
window.addEventListener('resize', scheduleActualizarAside);

// ResizeObserver para detectar cambios de tama√±o del header
if (window.ResizeObserver) {
  try {
    const ro = new ResizeObserver(scheduleActualizarAside);
    const headerEl = document.querySelector('header');
    if (headerEl) ro.observe(headerEl);
  } catch (e) {
    // noop
  }
}

// MutationObserver para cambios en el contenido del header
try {
  const headerEl = document.querySelector('header');
  if (headerEl && window.MutationObserver) {
    const mo = new MutationObserver(scheduleActualizarAside);
    mo.observe(headerEl, { attributes: true, childList: true, subtree: true, characterData: true });
  }
} catch (e) {
  // noop
}

// Asegurar recalculo cuando las im√°genes del header terminen de cargar
document.querySelectorAll('header img').forEach(img => {
  if (img.complete) return;
  img.addEventListener('load', scheduleActualizarAside);
  img.addEventListener('error', scheduleActualizarAside);
});

// Tambi√©n actualizar despu√©s de cargar los productos (por si cambian tama√±os)
const originalCargar = cargarProductos;
cargarProductos = async function() {
  await originalCargar();
  // peque√±o timeout por si el DOM cambia por renderizado
  setTimeout(scheduleActualizarAside, 50);
};

// Por seguridad, actualizar al inicio (sin bloquear)
scheduleActualizarAside();
  </script>
</body>
</html>